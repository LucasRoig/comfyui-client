datasource db {
    provider = "sqlite"
    url      = env("DB_FILE")
}

model Project {
    id   String @id @default(uuid())
    name String

    InputImage InputImage[]

    @@map("project")
}

model ImportTask {
    id String @id

    InputImage InputImage[]

    @@map("import_task")
}

model InputImage {
    id                String @id @default(uuid())
    originalFileName  String @map("original_file_name")
    originalPath String @map("original_path")
    type              String

    projectId String  @map("project_id")
    project   Project @relation(fields: [projectId], references: [id])

    importTaskId String     @map("import_task_id")
    importTask   ImportTask @relation(fields: [importTaskId], references: [id])

    @@unique([projectId, originalPath])
    @@map("input_image")
}

model ComfyWorkflow {
    id      String   @id @default(uuid())
    json    Json
    prompts Prompt[]

    @@map("comfy_workflow")
}

model Prompt {
    id           String        @id @default(uuid())
    json         Json
    workflowId   String        @map("workflow_id")
    workflow     ComfyWorkflow @relation(fields: [workflowId], references: [id])
    outputImages OutputImage[]

    @@map("prompt")
}

model OutputImage {
    id           String @id @default(uuid())
    filename     String
    relativePath String @map("relative_path")
    promptId     String @map("prompt_id")
    prompt       Prompt @relation(fields: [promptId], references: [id])
    nodeId       String @map("node_id")

    @@map("output_image")
}
